I can do that. Here is the complete, reformatted, and updated `README.md` file, which includes detailed, bilingually formatted instructions for all features, including the new script-sealing security measures.

# ü§ñ Telegram SysAdmin Bot

A powerful and secure Telegram bot, written in Python, to manage your Linux servers remotely. Execute commands, manage services, monitor system health, perform backups, and much more, all from the comfort of your Telegram chat.

-----

## üåü Main Features

  * **üîå Service Management:** Start, stop, restart, and check the status of system services (`systemd`) and Docker containers.
  * **üñ•Ô∏è Command Execution:** Securely execute terminal commands.
  * **üõ°Ô∏è Integrated Security:**
      * **Access Control:** Only authorized users can interact with the bot.
      * **Script Integrity Verification:** Uses SHA256 hashes to ensure scripts have not been tampered with.
      * **Command Injection Prevention:** Secure use of `subprocess`.
      * **Fail2Ban Management:** Unban IPs directly from the bot.
  * **üìÇ File Management:** Upload and download files to and from the server.
  * **üìà System Monitoring:** Get reports on CPU, RAM, disk usage, and system temperature.
  * **‚öôÔ∏è Custom Scripts:** Define your own scripts (`.sh`, `.py`) in the configuration file to automate repetitive tasks.
  * **ü§ñ AI Integration (Gemini):** Use Google's AI to analyze logs or assist with complex tasks.
  * **üåê Network Monitoring:** Perform pings, port scans (`nmap`), and check SSL certificate validity.

-----

## üöÄ Installation

1.  **Clone the repository:**

    ```bash
    git clone https://github.com/sabbat-cloud/telegram-admin-bot.git
    cd telegram-admin-bot
    ```

2.  **Create a virtual environment and install dependencies:**

    ```bash
    python3 -m venv venv
    source venv/bin/activate
    pip install -r requirements.txt
    ```

3.  **Configure the bot:**

      * Create a bot on Telegram using [@BotFather](https://t.me/BotFather) to get your **token**.
      * Talk to [@userinfobot](https://t.me/userinfobot) to get your **Chat ID**.
      * Copy `configbot.json.example` to `configbot.json` and `users.json.example` to `users.json`, then edit them with your information.

    <!-- end list -->

    ```bash
    cp configbot.json.example configbot.json
    cp users.json.example users.json
    nano configbot.json
    nano users.json
    ```

-----

## üõ°Ô∏è Critical Security: "Sealing" Your Scripts with `seal_scripts.py`

This is the most important security feature of the bot. To prevent the execution of scripts that have been modified without your permission (e.g., by an attacker), the bot verifies the **integrity** of each script before running it.

#### How It Works

  * When you run the `seal_scripts.py` script, it calculates a unique "digital signature" (a SHA256 hash) for each of your allowed scripts.
  * This signature is saved inside `configbot.json`.
  * When you ask the bot to run a script (e.g., `/run backup_web`), the bot recalculates the signature in real-time and compares it to the saved one.
  * ‚úÖ **If they match:** The script is safe and gets executed.
  * ‚ùå **If they DO NOT match:** The bot will refuse to run the script and send you an alert. This means the file has been altered\!

#### **Usage Instructions (VERY IMPORTANT\!)**

Every time you **modify** one of your scripts (`.sh` or `.py`) or **add a new one** to `configbot.json`, you MUST run the sealing script again.

1.  Modify or create your script file (e.g., `~/telegram/scripts/sh/my_new_script.sh`).
2.  Add the script to the `"scripts"` section of your `configbot.json`.
3.  Run the sealing script:
    ```bash
    python3 seal_scripts.py
    ```
4.  The script will automatically update all the hashes in `configbot.json`. Your bot now trusts the new version\!

-----

## üõ†Ô∏è Configuration

All configuration is managed through the `configbot.json` and `users.json` files.

  * **`users.json`**: Here you define who the Super Admin is and which other Telegram users are authorized to use the bot.

  * **`configbot.json`**:

      * **`telegram`**: Your token and chat\_id.
      * **`gemini_api`**: Enable and configure the Gemini API.
      * **`scripts`**: **(Unified Structure)** Define all your scripts here. This is the section that `seal_scripts.py` uses.

    **Example of the `scripts` section:**

    ```json
    "scripts": {
      "backup_web": {
        "path": "~/telegram/scripts/sh/backup/backup_web_full.sh",
        "description": "Performs a full backup of the web.",
        "sha256_hash": "e3b0c442... (this value is generated by seal_scripts.py)"
      },
      "check_ports": {
        "path": "~/telegram/scripts/py/check_ports.py",
        "description": "Scans for open ports on a host.",
        "sha256_hash": "f2d81a26... (this value is generated by seal_scripts.py)"
      }
    }
    ```

-----

## ‚ñ∂Ô∏è Running the Bot

You can run the bot directly or as a `systemd` service so it starts automatically.

  * **Directly:**
    ```bash
    python3 bot.py
    ```
  * **As a service (recommended):**
    1.  Edit the `telegram_bot.service` file to point to the correct paths of your installation.
    2.  Copy the file to systemd and enable it:
        ```bash
        sudo cp telegram_bot.service /etc/systemd/system/
        sudo systemctl daemon-reload
        sudo systemctl enable telegram_bot.service
        sudo systemctl start telegram_bot.service
        ```

-----

## Versi√≥n en Espa√±ol

### üåü Caracter√≠sticas Principales

  * **üîå Gesti√≥n de Servicios:** Inicia, detiene, reinicia y comprueba el estado de servicios del sistema (`systemd`) y contenedores Docker.
  * **üñ•Ô∏è Ejecuci√≥n de Comandos:** Ejecuta comandos de terminal de forma segura.
  * **üõ°Ô∏è Seguridad Integrada:**
      * **Control de Acceso:** Solo los usuarios autorizados pueden interactuar con el bot.
      * **Verificaci√≥n de Integridad de Scripts:** ¬°NUEVO\! Usa hashes SHA256 para garantizar que los scripts no hayan sido manipulados.
      * **Prevenci√≥n de Command Injection:** Uso de `subprocess` de forma segura.
      * **Gesti√≥n de Fail2Ban:** Desbanea IPs directamente desde el bot.
  * **üìÇ Gesti√≥n de Ficheros:** Sube y descarga ficheros desde y hacia el servidor.
  * **üìà Monitorizaci√≥n del Sistema:** Obt√©n informes sobre el uso de CPU, RAM, disco y la temperatura del sistema.
  * **‚öôÔ∏è Scripts Personalizados:** Define tus propios scripts (`.sh`, `.py`) en el fichero de configuraci√≥n para automatizar tareas repetitivas.
  * **ü§ñ Integraci√≥n con IA (Gemini):** Utiliza la IA de Google para analizar logs o ayudarte con tareas complejas.
  * **üåê Monitorizaci√≥n de Red:** Realiza pings, escaneos de puertos (`nmap`) y comprueba la validez de certificados SSL.

-----

### üöÄ Instalaci√≥n

1.  **Clona el repositorio:**

    ```bash
    git clone https://github.com/sabbat-cloud/telegram-admin-bot.git
    cd telegram-admin-bot
    ```

2.  **Crea un entorno virtual e instala las dependencias:**

    ```bash
    python3 -m venv venv
    source venv/bin/activate
    pip install -r requirements.txt
    ```

3.  **Configura el bot:**

      * Crea un bot en Telegram usando [@BotFather](https://t.me/BotFather) para obtener tu **token**.
      * Habla con [@userinfobot](https://t.me/userinfobot) para obtener tu **Chat ID**.
      * Copia `configbot.json.example` a `configbot.json` y `users.json.example` a `users.json` y ed√≠talos con tu informaci√≥n.

    <!-- end list -->

    ```bash
    cp configbot.json.example configbot.json
    cp users.json.example users.json
    nano configbot.json
    nano users.json
    ```

-----

### üõ°Ô∏è Seguridad Cr√≠tica: "Sellar" tus Scripts con `seal_scripts.py`

Esta es la caracter√≠stica de seguridad m√°s importante del bot. Para prevenir la ejecuci√≥n de scripts que hayan sido modificados sin tu permiso (por ejemplo, por un atacante), el bot verifica la **integridad** de cada script antes de ejecutarlo.

#### ¬øC√≥mo Funciona?

  * Cuando ejecutas el script `seal_scripts.py`, este calcula una "firma digital" (un hash SHA256) √∫nica para cada uno de tus scripts permitidos.
  * Esta firma se guarda dentro de `configbot.json`.
  * Cuando le pides al bot que ejecute un script (ej. `/run backup_web`), el bot vuelve a calcular la firma en tiempo real y la compara con la que tiene guardada.
  * ‚úÖ **Si coinciden:** El script es seguro y se ejecuta.
  * ‚ùå **Si NO coinciden:** El bot se negar√° a ejecutar el script y te enviar√° una alerta. ¬°Esto significa que el fichero ha sido alterado\!

#### **Instrucciones de Uso (¬°MUY IMPORTANTE\!)**

Cada vez que **modifiques** uno de tus scripts (`.sh` o `.py`) o **a√±adas uno nuevo** a `configbot.json`, DEBES volver a ejecutar el script de sellado.

1.  Modifica o crea tu fichero de script (ej. `~/telegram/scripts/sh/mi_nuevo_script.sh`).
2.  A√±ade el script a la secci√≥n `"scripts"` de tu `configbot.json`.
3.  Ejecuta el script de sellado:
    ```bash
    python3 seal_scripts.py
    ```
4.  El script actualizar√° autom√°ticamente todos los hashes en `configbot.json`. ¬°Tu bot ya conf√≠a en la nueva versi√≥n\!

-----

### üõ†Ô∏è Configuraci√≥n

Toda la configuraci√≥n se gestiona a trav√©s de los ficheros `configbot.json` y `users.json`.

  * **`users.json`**: Aqu√≠ defines qui√©n es el Super Administrador y qu√© otros usuarios de Telegram est√°n autorizados para usar el bot.

  * **`configbot.json`**:

      * **`telegram`**: Tu token y chat\_id.
      * **`gemini_api`**: Activa y configura la API de Gemini.
      * **`scripts`**: **(Estructura Unificada)** Define todos tus scripts aqu√≠. Esta es la secci√≥n que `seal_scripts.py` utiliza.

    **Ejemplo de la secci√≥n `scripts`:**

    ```json
    "scripts": {
      "backup_web": {
        "path": "~/telegram/scripts/sh/backup/backup_web_full.sh",
        "description": "Realiza un respaldo completo de la web.",
        "sha256_hash": "e3b0c442... (este valor es generado por seal_scripts.py)"
      },
      "check_ports": {
        "path": "~/telegram/scripts/py/check_ports.py",
        "description": "Escanea puertos abiertos en un host.",
        "sha256_hash": "f2d81a26... (este valor es generado por seal_scripts.py)"
      }
    }
    ```

-----

### ‚ñ∂Ô∏è Ejecutar el Bot

Puedes ejecutar el bot directamente o como un servicio de `systemd` para que se inicie autom√°ticamente.

  * **Directamente:**
    ```bash
    python3 bot.py
    ```
  * **Como servicio (recomendado):**
    1.  Edita el fichero `telegram_bot.service` para que apunte a las rutas correctas de tu instalaci√≥n.
    2.  Copia el fichero a systemd y act√≠valo:
        ```bash
        sudo cp telegram_bot.service /etc/systemd/system/
        sudo systemctl daemon-reload
        sudo systemctl enable telegram_bot.service
        sudo systemctl start telegram_bot.service
        ```
